package org.openmrs.module.eptsreports.reporting.library.queries;

public interface QualityImprovementQueriesCAT13NuminatorP2 {

    class QUERY {

        public static final String findPatientsWhoAreRequestForLaboratoryInvestigationsInclusionPeriodByH =
                  " SELECT tx_new.patient_id, min(fisrtConsultation.encounter_datetime) AS encounter_datetime FROM (  "
                + " SELECT patient_id, MIN(art_start_date) art_start_date FROM ( "
                + " SELECT p.patient_id, MIN(value_datetime) art_start_date FROM patient p "
                + " INNER JOIN encounter e ON p.patient_id = e.patient_id "
                + " INNER JOIN obs o ON e.encounter_id = o.encounter_id "
                + " WHERE p.voided = 0 AND e.voided = 0 AND o.voided = 0 AND e.encounter_type = 53 "
                + " AND o.concept_id = 1190 AND o.value_datetime is NOT NULL AND o.value_datetime <= :endInclusionDate AND e.location_id = :location "
                + " GROUP BY p.patient_id "
                + " UNION "
                + " Select p.patient_id, min(o.value_datetime) art_start_date from patient p "
                + " inner join encounter e on p.patient_id = e.patient_id "
                + " inner join obs o on e.encounter_id = o.encounter_id "
                + " inner join obs oLevantou on e.encounter_id = oLevantou.encounter_id "
                + " where p.voided = 0 and e.voided = 0 and o.voided = 0 and oLevantou.voided = 0 and e.encounter_type = 52 and o.concept_id = 23866 and "
                + " o.value_datetime is not null and o.value_datetime <= :endInclusionDate and e.location_id = :location and "
                + " oLevantou.concept_id = 23865 and oLevantou.value_coded = 1065 "
                + " group by p.patient_id  "
                + " ) art_start "
                + " GROUP BY patient_id  "
                + " ) tx_new "
                + " INNER JOIN "
                + " ( "
                + " SELECT p.patient_id, cc.encounter_datetime as encounter_datetime "
                + " FROM 	patient p "
                + " INNER JOIN encounter cc ON p.patient_id = cc.patient_id "
                + " INNER JOIN obs o ON cc.encounter_id = o.encounter_id "
                + " WHERE 	cc.voided = 0 AND cc.encounter_type = 6  AND cc.location_id = :location "
                + " AND o.concept_id = 23722 AND o.value_coded = 856 AND o.voided = 0 "
                + " ) fisrtConsultation ON fisrtConsultation.patient_id = tx_new.patient_id "
                + " INNER JOIN person pe ON tx_new.patient_id = pe.person_id "
                + " WHERE fisrtConsultation.encounter_datetime BETWEEN date_add(tx_new.art_start_date, INTERVAL 80 DAY) AND date_add(tx_new.art_start_date, INTERVAL 130 DAY) "
                + " AND (TIMESTAMPDIFF(year, birthdate, art_start_date)) >= 15 AND birthdate IS NOT NULL AND pe.voided = 0 AND pe.gender = 'F' "
                + " AND tx_new.art_start_date BETWEEN :startInclusionDate AND :endInclusionDate "
                + " GROUP BY tx_new.patient_id ";

        public static final String findPatientsWhoAreRequestForLaboratoryInvestigationAndPregnantInclusionPeriodByJ =
                  " SELECT fisrtConsultation.patient_id "
                + " FROM "
                + " ( "
                + " SELECT p.patient_id, min(cc.encounter_datetime) as encounter_datetime "
                + " FROM patient p "
                + " INNER JOIN encounter cc ON p.patient_id = cc.patient_id "
                + " INNER JOIN obs o ON cc.encounter_id = o.encounter_id "
                + " WHERE cc.voided = 0 AND cc.encounter_type = 6  AND cc.location_id = :location "
                + " AND cc.encounter_datetime BETWEEN :startInclusionDate AND :endInclusionDate "
                + " AND o.concept_id = 1982 AND o.value_coded = 1065 AND o.voided = 0 "
                + " GROUP BY p.patient_id "
                + " ) fisrtConsultation "
                + " INNER JOIN obs cv ON cv.person_id = fisrtConsultation.patient_id "
                + " INNER JOIN person pe ON fisrtConsultation.patient_id = pe.person_id "
                + " WHERE cv.concept_id = 23722 AND cv.value_coded = 856 AND cv.voided = 0 "
                + " AND (TIMESTAMPDIFF(year, birthdate, fisrtConsultation.encounter_datetime)) >= 15 AND birthdate IS NOT NULL "
                + " AND pe.voided = 0 AND pe.gender = 'F' ";

        public static final String findPatientsWhoHaveCVResultAfter33DaysOfRequestByK =
                  " SELECT B3.patient_id FROM "
                + " (SELECT tx_new.patient_id AS patient_id, min(fisrtConsultation.encounter_datetime) AS encounter_datetime, tx_new.art_start_date FROM ( "
                + " SELECT patient_id, MIN(art_start_date) art_start_date FROM ( "
                + " SELECT p.patient_id, MIN(value_datetime) art_start_date FROM patient p "
                + " INNER JOIN encounter e ON p.patient_id = e.patient_id "
                + " INNER JOIN obs o ON e.encounter_id = o.encounter_id "
                + " WHERE p.voided = 0 AND e.voided = 0 AND o.voided = 0 AND e.encounter_type = 53 "
                + " AND o.concept_id = 1190 AND o.value_datetime is NOT NULL AND o.value_datetime <= :endInclusionDate AND e.location_id = :location "
                + " GROUP BY p.patient_id "
                + " UNION "
                + " Select p.patient_id, min(o.value_datetime) art_start_date from patient p "
                + " INNER JOIN encounter e on p.patient_id = e.patient_id "
                + " INNER JOIN obs o on e.encounter_id = o.encounter_id "
                + " INNER JOIN obs oLevantou on e.encounter_id = oLevantou.encounter_id "
                + " where p.voided = 0 and e.voided = 0 and o.voided = 0 and oLevantou.voided = 0 and e.encounter_type = 52 and o.concept_id = 23866 and "
                + " o.value_datetime is not null and o.value_datetime <= :endInclusionDate and e.location_id = :location and "
                + " oLevantou.concept_id = 23865 and oLevantou.value_coded = 1065 "
                + " GROUP BY p.patient_id "
                + " ) art_start "
                + " GROUP BY patient_id "
                + " ) tx_new "
                + " INNER JOIN "
                + " ( "
                + " SELECT p.patient_id, cc.encounter_datetime as encounter_datetime "
                + " FROM patient p "
                + " INNER JOIN encounter cc ON p.patient_id = cc.patient_id "
                + " INNER JOIN obs o ON cc.encounter_id = o.encounter_id "
                + " WHERE cc.voided = 0 AND cc.encounter_type = 6  AND cc.location_id = :location "
                + " AND o.concept_id = 23722 AND o.value_coded = 856 AND o.voided = 0 "
                + " ) fisrtConsultation ON fisrtConsultation.patient_id = tx_new.patient_id "
                + " INNER JOIN person pe ON tx_new.patient_id = pe.person_id "
                + " WHERE fisrtConsultation.encounter_datetime BETWEEN date_add(tx_new.art_start_date, INTERVAL 80 DAY) AND date_add(tx_new.art_start_date, INTERVAL 130 DAY) "
                + " AND (TIMESTAMPDIFF(year, birthdate, art_start_date)) >= 15 AND birthdate IS NOT NULL AND pe.voided = 0 AND pe.gender = 'F' "
                + " AND tx_new.art_start_date BETWEEN :startInclusionDate AND :endInclusionDate "
                + " GROUP BY tx_new.patient_id) AS B3 "
                + " INNER JOIN encounter e ON e.patient_id = B3.patient_id AND e.voided = 0 AND e.encounter_type = 6 AND e.location_id = :location "
                + " INNER JOIN obs o ON o.encounter_id = e.encounter_id AND o.voided = 0 "
                + " WHERE e.encounter_datetime > B3.encounter_datetime AND e.encounter_datetime <= date_add(B3.encounter_datetime, INTERVAL 33 DAY) "
                + " AND ((o.concept_id = 856 AND o.value_numeric IS NOT NULL) OR (o.concept_id = 1305 AND o.value_coded IS NOT NULL)) ";

        public static final String findPatientsWhoHaveCVResultAfeter33DaysOfRequestForPregnantWishRequestedCVByL =
                " SELECT B4.patient_id FROM "
                + " (SELECT fisrtConsultation.patient_id, fisrtConsultation.encounter_datetime "
                + " FROM "
                + " ( "
                + " SELECT 	p.patient_id, min(cc.encounter_datetime) as encounter_datetime "
                + " FROM patient p "
                + " INNER JOIN encounter cc ON p.patient_id = cc.patient_id "
                + " INNER JOIN obs o ON cc.encounter_id = o.encounter_id "
                + " WHERE cc.voided = 0 AND cc.encounter_type = 6  AND cc.location_id = :location "
                + " AND cc.encounter_datetime BETWEEN :startInclusionDate AND :endInclusionDate "
                + " AND o.concept_id = 1982 AND o.value_coded = 1065 AND o.voided = 0 "
                + " GROUP BY p.patient_id "
                + " ) fisrtConsultation "
                + " INNER JOIN obs cv ON cv.person_id = fisrtConsultation.patient_id "
                + " INNER JOIN person pe ON fisrtConsultation.patient_id = pe.person_id "
                + " WHERE cv.concept_id = 23722 AND cv.value_coded = 856 AND cv.voided = 0 "
                + " AND (TIMESTAMPDIFF(year, birthdate, fisrtConsultation.encounter_datetime)) >= 15 AND birthdate IS NOT NULL "
                + " AND pe.voided = 0 AND pe.gender = 'F') AS B4 "
                + " INNER JOIN encounter e ON e.patient_id = B4.patient_id AND e.voided = 0 AND e.encounter_type = 6 AND e.location_id = :location "
                + " INNER JOIN obs o ON o.encounter_id = e.encounter_id AND o.voided = 0 "
                + " WHERE e.encounter_datetime > B4.encounter_datetime AND e.encounter_datetime <= date_add(B4.encounter_datetime, INTERVAL 33 DAY) "
                + " AND ((o.concept_id = 856 AND o.value_numeric IS NOT NULL) OR (o.concept_id = 1305 AND o.value_coded IS NOT NULL)) ";
    }
}
